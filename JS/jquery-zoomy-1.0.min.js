/*
 *
 * Zoomy v1.0 - for jQuery 1.7.1+
 *
 * Copyright 2012, James Louis Thompson
 * http://codecanyon.net/user/jameslouiz
 *
 * You need to buy a license to use this script.
 * http://codecanyon.net/wiki/buying/howto-buying/licensing/
 *
 * Date: 20/06/2012
 *
 */
(function(e){e.bind=function(t,n){var r=Array.prototype.slice.call(arguments,2);return function(){var i=[this].concat(r,e.makeArray(arguments));return n.apply(t,i)}};var t=function(){};t.prototype={init:function(t,n){this.e=e(t);var r=this,i={popoverClassName:"popover",popoverHeight:e(t).find("img").height()*1.5,popoverWidth:e(t).find("img").width()*1.5,popoverPosition:"right",popoverOffsetX:30,popoverOffsetY:0,lensHeight:e(t).find("img").height()/1.5,lensWidth:e(t).find("img").width()/1.5,magnify:1,triggerEvent:"hover",innerZoom:false,preload:true,showPreloader:true,duration:200,callbacks:{zoomedFail:false,zoomedSuccess:false}};this.dataOptions=this.e.data();if(typeof this.dataOptions==="object"&&!e.isEmptyObject(this.dataOptions)){this.settings=e.extend(true,i,this.dataOptions)}else{this.settings=e.extend(true,i,n)}this.body=e("html body");this.popoverHtml="<div class="+this.settings.popoverClassName+"><img class="+this.settings.popoverClassName+"_image"+' src="" /></div>';this.sandboxHtml="<div class="+this.settings.popoverClassName+"_sandbox"+"></div>";this.lensHtml='<div class="lens"></div>';this.preloaderHtml='<div class="preloader"></div>';this.thumb=this.e.find("img");this.id=Math.floor(Math.random()*999999999);this.zoomedImageSource=this.e.data("zoomed-image");this.useSelf=!this.zoomedImageSource?true:false;this.loaded=false;this.popoverWidth=this.settings.popoverWidth;this.popoverHeight=this.settings.popoverHeight;this.lensWidth=this.settings.lensWidth;this.lensHeight=this.settings.lensHeight;this.inject();this.lens=this.e.find(".lens");this.popover=e("."+this.settings.popoverClassName);this.sandbox=e("."+this.settings.popoverClassName+"_sandbox");this.preloader=this.e.find(".preloader");this.popover.css({overflow:"hidden",display:"none",position:"absolute","z-index":9999,padding:0});this.e.css({position:"relative",cursor:"crosshair"});this.lens.css({height:0,width:0,position:"absolute",top:-1e4,left:-1e4,overflow:"hidden","z-index":9999,display:"block"});this.lens.find("img").css({position:"relative"});this.sandbox.css({height:1,width:1,position:"absolute",top:-5e3,left:-5e3,display:"block",overflow:"hidden"});this.sandbox.find("img").css({position:"absolute",top:0,left:0});this.preloader.css({top:"50%",left:"50%","margin-left":-(this.preloader.outerWidth()/2),"margin-top":-(this.preloader.outerHeight()/2),display:"none",padding:0,position:"absolute"});this.thumb.attr({src:this.thumb.attr("src")+"?"+this.id});this.e.attr({"data-zoomed-image":this.e.attr("data-zoomed-image")+"?"+this.id});if(this.useSelf){this.e.attr({"data-zoomed-image":this.thumb.attr("src")})}this.zoomedImageSource=this.e.attr("data-zoomed-image");if(this.thumb.attr("data-status")!=="error"){if(this.settings.preload){this.loadImages()}else{this.eventBindings()}}},callHook:function(t){if(e.isFunction(this.settings.callbacks[t])){this.settings.callbacks[t](this)}},inject:function(){this.e.append(this.lensHtml);this.e.append(this.preloaderHtml);if(e("."+this.settings.popoverClassName).length<1){this.body.append(this.popoverHtml)}if(e("."+this.settings.popoverClassName+"_sandbox").length<1){this.body.append(this.sandboxHtml)}},loadImages:function(){var t=this,n=this.e,r=this.thumb,i=this.settings.showPreloader,s=this.preloader,o=this.zoomedImageSource,u=this.thumb.data("loaded"),a=this.sandbox.find("img").attr("src"),f=new Image;if(!u&&o){if(this.settings.showPreloader){s.fadeIn(200)}e(f).load(function(){var n=e(this),r;t.injectImages(n);t.callHook("zoomedSuccess")}).attr({src:o}).error(function(){r.data("loaded","failed");s.fadeOut(200);t.callHook("zoomedFail")})}else{this.grabData()}},grabData:function(){var e=this.zoomedImageSource,t=this.sandbox.find('img[src="'+e+'"]'),n,r;this.lens.hide();if(this.useSelf){r=this.thumb.attr("src");n=this.sandbox.find('img[src="'+r+'"]')}else{n=t;r=e}if(this.settings.innerZoom){if(this.lens.find("img").length<1){this.lens.append(n.clone())}}else{if(e!==this.popover.find("img").attr("src")){this.popover.html(n.clone())}}this.showElems()},eventBindings:function(){var t=this,n=this.e,r=this.popover,i=this.lens,s=this.settings.preload,o;switch(this.settings.triggerEvent){case"click":o="click";break;default:o="mouseenter";break}n.on(o,function(){if(s){t.grabData()}else{t.loadImages()}e("body").on("mousemove.zoomy",i,function(e){t.lensPos(e)})});n.on("mouseleave",function(){e("body").off("mousemove.zoomy");t.hideElems()})},injectImages:function(e){var t=this.thumb.data("loaded"),n,r;if(this.settings.innerZoom){n=this.lens}else{n=this.sandbox}if(this.zoomedImageSource!=n.find("img").attr("src")){e.css({position:"absolute"});n.append(e)}this.magnify(e);if(this.settings.preload&&!t){this.eventBindings()}else{this.grabData(e)}this.preloader.fadeOut(200);this.thumb.data("loaded",true)},lensSize:function(e){var t=this.popver,n=this.lens,r=this.thumb,i=this.popoverHeight,s=this.popoverWidth,o=r.height(),u=r.width(),a,f,l,c,h,p;if(this.settings.innerZoom){a=this.lensHeight;f=this.lensWidth}else{a=i/(e.height()/o);f=s/(e.width()/u)}lensDims={height:a+0,width:f+0};n.css(lensDims)},lensPos:function(e){function h(){return u-a/2<i}function p(){return u+a/2>i+r.width()}function d(){return o-f/2<s}function v(){return o+f/2>s+r.height()}var t=this,n=this.lens,r=this.thumb,i=r.offset().left,s=r.offset().top,o=e.pageY,u=e.pageX,a=n.outerWidth(),f=n.outerHeight(),l=0,c=0;c=o-f/2;l=u-a/2;if(h(n)){l=i}else if(p(n)){l=i+r.width()-a}if(d(n)){c=s}else if(v(n)){c=s+r.height()-f}n.offset({top:c,left:l});t.zoomedPosition()},popoverPos:function(){if(!this.settings.innerZoom){var e=this,t=this.lens,n=this.thumb,r=this.popover;var i,s;switch(this.settings.popoverPosition){case"right":i=n.offset().top+this.settings.popoverOffsetY;s=n.offset().left+n.outerWidth()+this.settings.popoverOffsetX;break;case"top":i=n.offset().top-this.popoverHeight-this.settings.popoverOffsetY;s=n.offset().left+this.settings.popoverOffsetX;break;case"bottom":i=n.offset().top+n.outerHeight()+this.settings.popoverOffsetY;s=n.offset().left+this.settings.popoverOffsetX;break;case"left":i=n.offset().top+this.settings.popoverOffsetY;s=n.offset().left-this.popoverWidth-this.settings.popoverOffsetX;break}r.show();r.css({height:this.popoverHeight,width:this.popoverWidth});popoverPos={top:i,left:s};r.offset(popoverPos);r.hide()}},zoomedPosition:function(){var e=this.settings.innerZoom?this.lens.find("img"):this.popover.find("img"),t=this.thumb,n=this.lens,r=n.css("border-top-width")>0?parseFloat(n.css("border-top-width")):0,i=n.css("border-left-width")>0?parseFloat(n.css("border-left-width")):0,s=n.outerHeight(),o=n.outerWidth(),u=t.height(),a=t.width(),f=e.height(),l=e.width(),c=t.offset().top-(n.offset().top+r),h=t.offset().left-(n.offset().left+i);if(this.settings.innerZoom){hr=(f-s)/(u-s);wr=(l-o)/(a-o)}else{hr=f/u;wr=l/a}e.css({top:c*hr,left:h*wr})},magnify:function(e){var t=e.height(),n=e.width(),r=this.settings.magnify;e.css({height:t*r,width:n*r});this.lensSize(e)},showElems:function(){if(!this.settings.innerZoom){this.popoverPos();this.popover.stop().fadeTo(this.settings.duration,1)}this.lens.stop(true,true).fadeTo(this.settings.duration,1)},hideElems:function(){if(this.popover.is(":visible")||this.popover.is(":hidden")&&this.popover.is(":animated")){this.popover.stop().fadeOut(this.settings.duration)}if(this.lens.is(":visible")||this.lens.is(":hidden")&&this.lens.is(":animated")){this.lens.stop().fadeOut(this.settings.duration)}}},e.fn.zoomy=function(n){function s(){if(!n&&r[0].zoomy){return i.get(0).zoomy}else{return r.each(function(){if(!this.zoomy){this.zoomy=new t;this.zoomy.init(this,n)}else{e(this).get(0).zoomy}})}}var r=this,i=e(this);if(!e.browser.msie){var o=r.find("img"),u=o.length,a="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",f="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";o.bind("load.imgloaded",function(){if(--u<=0&&this.src!==a||this.src==f){o.unbind("load.imgloaded");s()}}).each(function(){var t=e(this).attr("src");if(this.complete||this.complete===undefined){var n=this.src;this.src=a;this.src=n}e(this).error(function(){e(this).attr("data-status","error");this.src=f}).attr({src:this.src})})}else{s()}}})(jQuery)