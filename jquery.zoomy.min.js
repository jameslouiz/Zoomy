/*!
 * Zoomy - v2.0.0
 *
 * Simple, light weight and robust image zoom plugin
 *
 * By James Thomoson - @jameslouiz
 *    james.tommo@yahoo.co.uk
 *    http://jameslouiz.com
 *
 */(function(t){t.bind=function(s,i){var e=Array.prototype.slice.call(arguments,2);return function(){var o=[this].concat(e,t.makeArray(arguments));return i.apply(s,o)}};var s=function(){};s.prototype={init:function(s,i){this.e=t(s);var e={popoverClassName:"popover",popoverHeight:1.5*t(s).find("img").height(),popoverWidth:1.5*t(s).find("img").width(),popoverPosition:"right",popoverOffsetX:30,popoverOffsetY:0,lensHeight:t(s).find("img").height()/1.5,lensWidth:t(s).find("img").width()/1.5,magnify:1,triggerEvent:"hover",innerZoom:!1,preload:!0,showPreloader:!0,duration:200};this.dataOptions=this.e.data(),i&&(this.settings=t.extend(!0,e,i)),"object"!=typeof this.dataOptions||t.isEmptyObject(this.dataOptions)||(this.settings=t.extend(!0,this.settings,this.dataOptions)),this.body=t("html body"),this.popoverHtml="<div class="+this.settings.popoverClassName+"><img class="+this.settings.popoverClassName+"_image"+' src="" /></div>',this.sandboxHtml="<div class="+this.settings.popoverClassName+"_sandbox"+"></div>",this.lensHtml='<div class="lens"></div>',this.preloaderHtml='<div class="preloader"></div>',this.thumb=this.e.find("img"),this.id=Math.floor(999999999*Math.random()),this.zoomedImageSource=this.e.data("zoomed-image"),this.useSelf=this.zoomedImageSource?!1:!0,this.loaded=!1,this.popoverWidth=this.settings.popoverWidth,this.popoverHeight=this.settings.popoverHeight,this.lensWidth=this.settings.lensWidth,this.lensHeight=this.settings.lensHeight,this.inject(),this.lens=this.e.find(".lens"),this.popover=t("."+this.settings.popoverClassName),this.sandbox=t("."+this.settings.popoverClassName+"_sandbox"),this.preloader=this.e.find(".preloader"),this.popover.css({overflow:"hidden",display:"none",position:"absolute","z-index":9999,padding:0}),this.e.css({position:"relative",cursor:"crosshair"}),this.lens.css({height:0,width:0,position:"absolute",top:-1e4,left:-1e4,overflow:"hidden","z-index":9999,display:"block"}),this.lens.find("img").css({position:"relative"}),this.sandbox.css({height:1,width:1,position:"absolute",top:-5e3,left:-5e3,display:"block",overflow:"hidden"}),this.sandbox.find("img").css({position:"absolute",top:0,left:0}),this.preloader.css({top:"50%",left:"50%","margin-left":-(this.preloader.outerWidth()/2),"margin-top":-(this.preloader.outerHeight()/2),display:"none",padding:0,position:"absolute"}),this.thumb.attr({src:this.thumb.attr("src")+"?"+this.id}),this.e.attr({"data-zoomed-image":this.e.attr("data-zoomed-image")+"?"+this.id}),this.useSelf&&this.e.attr({"data-zoomed-image":this.thumb.attr("src")}),this.zoomedImageSource=this.e.attr("data-zoomed-image"),"error"!==this.thumb.attr("data-status")&&(this.settings.preload?this.loadImages():this.eventBindings())},inject:function(){this.e.append(this.lensHtml),this.e.append(this.preloaderHtml),1>t("."+this.settings.popoverClassName).length&&this.body.append(this.popoverHtml),1>t("."+this.settings.popoverClassName+"_sandbox").length&&this.body.append(this.sandboxHtml)},loadImages:function(){var s=this,i=(this.e,this.thumb),e=(this.settings.showPreloader,this.preloader),o=this.zoomedImageSource,h=this.thumb.data("loaded"),n=(this.sandbox.find("img").attr("src"),new Image);!h&&o?(this.settings.showPreloader&&e.fadeIn(200),t(n).load(function(){var i=t(this);s.injectImages(i)}).attr({src:o}).error(function(){i.data("loaded","failed"),s.callHook("loadFail")})):this.grabData()},grabData:function(){var t,s,i=this.zoomedImageSource,e=this.sandbox.find('img[src="'+i+'"]');this.lens.hide(),this.useSelf?(s=this.thumb.attr("src"),t=this.sandbox.find('img[src="'+s+'"]')):(t=e,s=i),this.settings.innerZoom?1>this.lens.find("img").length&&this.lens.append(t.clone()):i!==this.popover.find("img").attr("src")&&this.popover.html(t.clone()),this.showElems()},eventBindings:function(){var s,i=this,e=this.e,o=(this.popover,this.lens),h=this.settings.preload;switch(this.settings.triggerEvent){case"click":s="click";break;default:s="mouseenter"}e.on(s,function(){h?i.grabData():i.loadImages(),t("body").on("mousemove.zoomy",o,function(t){i.lensPos(t)})}),e.on("mouseleave",function(){t("body").off("mousemove.zoomy"),i.hideElems()})},injectImages:function(t){var s,i=this.thumb.data("loaded");s=this.settings.innerZoom?this.lens:this.sandbox,this.zoomedImageSource!=s.find("img").attr("src")&&(t.css({position:"absolute"}),s.append(t)),this.magnify(t),this.settings.preload&&!i?this.eventBindings():this.grabData(t),this.preloader.fadeOut(200),this.thumb.data("loaded",!0)},lensSize:function(t){var s,i,e=(this.popver,this.lens),o=this.thumb,h=this.popoverHeight,n=this.popoverWidth,a=o.height(),r=o.width();this.settings.innerZoom?(s=this.lensHeight,i=this.lensWidth):(s=h/(t.height()/a),i=n/(t.width()/r)),lensDims={height:s+0,width:i+0},e.css(lensDims)},lensPos:function(t){function s(){return r>l-f/2}function i(){return l+f/2>r+a.width()}function e(){return d>p-g/2}function o(){return p+g/2>d+a.height()}var h=this,n=this.lens,a=this.thumb,r=a.offset().left,d=a.offset().top,p=t.pageY,l=t.pageX,f=n.outerWidth(),g=n.outerHeight(),m=0,c=0;c=p-g/2,m=l-f/2,s(n)?m=r:i(n)&&(m=r+a.width()-f),e(n)?c=d:o(n)&&(c=d+a.height()-g),n.offset({top:c,left:m}),h.zoomedPosition()},popoverPos:function(){if(!this.settings.innerZoom){var t,s,i=(this.lens,this.thumb),e=this.popover;switch(this.settings.popoverPosition){case"right":t=i.offset().top+this.settings.popoverOffsetY,s=i.offset().left+i.outerWidth()+this.settings.popoverOffsetX;break;case"top":t=i.offset().top-this.popoverHeight-this.settings.popoverOffsetY,s=i.offset().left+this.settings.popoverOffsetX;break;case"bottom":t=i.offset().top+i.outerHeight()+this.settings.popoverOffsetY,s=i.offset().left+this.settings.popoverOffsetX;break;case"left":t=i.offset().top+this.settings.popoverOffsetY,s=i.offset().left-this.popoverWidth-this.settings.popoverOffsetX}e.show(),e.css({height:this.popoverHeight,width:this.popoverWidth}),popoverPos={top:t,left:s},e.offset(popoverPos),e.hide()}},zoomedPosition:function(){var t=this.settings.innerZoom?this.lens.find("img"):this.popover.find("img"),s=this.thumb,i=this.lens,e=i.css("border-top-width")>0?parseFloat(i.css("border-top-width")):0,o=i.css("border-left-width")>0?parseFloat(i.css("border-left-width")):0,h=i.outerHeight(),n=i.outerWidth(),a=s.height(),r=s.width(),d=t.height(),p=t.width(),l=s.offset().top-(i.offset().top+e),f=s.offset().left-(i.offset().left+o);this.settings.innerZoom?(hr=(d-h)/(a-h),wr=(p-n)/(r-n)):(hr=d/a,wr=p/r),t.css({top:l*hr,left:f*wr})},magnify:function(t){var s=t.height(),i=t.width(),e=this.settings.magnify;t.css({height:s*e,width:i*e}),this.lensSize(t)},showElems:function(){this.settings.innerZoom||(this.popoverPos(),this.popover.stop().fadeTo(this.settings.duration,1)),this.lens.stop(!0,!0).fadeTo(this.settings.duration,1)},hideElems:function(){(this.popover.is(":visible")||this.popover.is(":hidden")&&this.popover.is(":animated"))&&this.popover.stop().fadeOut(this.settings.duration),(this.lens.is(":visible")||this.lens.is(":hidden")&&this.lens.is(":animated"))&&this.lens.stop().fadeOut(this.settings.duration)}},t.fn.zoomy=function(i){function e(){return!i&&o[0].zoomy?h.get(0).zoomy:o.each(function(){this.zoomy?t(this).get(0).zoomy:(this.zoomy=new s,this.zoomy.init(this,i))})}var o=this,h=t(this),n=(!document.documentMode||9>document.documentMode)&&window.attachEvent&&!window.addEventListener;if(n)e();else{var a=o.find("img"),r=a.length,d="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",p="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";a.bind("load.imgloaded",function(){(0>=--r&&this.src!==d||this.src==p)&&(a.unbind("load.imgloaded"),e())}).each(function(){if(t(this).attr("src"),this.complete||void 0===this.complete){var s=this.src;this.src=d,this.src=s}t(this).error(function(){t(this).attr("data-status","error"),this.src=p}).attr({src:this.src})})}}})(jQuery);